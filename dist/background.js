console.log("Фоновый скрипт загружен.");let l=!1,t="",c="";function a(e,r){console.log("Переопределение fetch начато."),window.originalFetch||(window.originalFetch=window.fetch,console.log("Оригинальный fetch сохранен.")),window.fetch=async(o,n)=>{const i=typeof o=="string"?o:o instanceof URL?o.href:o.url;return console.log("Обнаружен fetch-запрос:",i),e&&i.includes(e)?(console.log("Перехвачен запрос:",i),console.log("Возвращаем mock-данные:",r),new Response(r,{status:200,headers:{"Content-Type":"application/json"}})):(console.log("Запрос не перехвачен, выполняется оригинальный fetch."),window.originalFetch(o,n))},console.log("Перехват fetch-запросов активирован.")}function s(){window.originalFetch?(window.fetch=window.originalFetch,console.log("Оригинальный fetch восстановлен.")):console.log("Оригинальный fetch не найден.")}chrome.runtime.onMessage.addListener((e,r,o)=>{console.log("Получено сообщение:",e),e.action==="activate"?(l=!0,t=e.path,c=e.data,chrome.storage.local.set({isActive:l,mockPath:t,mockData:c},()=>{console.log("Данные сохранены:",{isActive:l,mockPath:t,mockData:c}),chrome.tabs.query({active:!0,currentWindow:!0},n=>{var i;(i=n[0])!=null&&i.id&&chrome.scripting.executeScript({target:{tabId:n[0].id},func:a,args:[t,c],world:"MAIN"})})})):e.action==="deactivate"&&(l=!1,t="",c="",chrome.storage.local.set({isActive:l,mockPath:t,mockData:c},()=>{console.log("Данные сохранены:",{isActive:l,mockPath:t,mockData:c}),chrome.tabs.query({active:!0,currentWindow:!0},n=>{var i;(i=n[0])!=null&&i.id&&chrome.scripting.executeScript({target:{tabId:n[0].id},func:s,world:"MAIN"})})}))});chrome.storage.local.get(["path","data","isActive"],e=>{t=e.path||"",c=e.data||"",l=e.isActive||!1,console.log("Данные загружены из хранилища:",{mockPath:t,mockData:c,isActive:l}),l&&h(t,c)});async function h(e,r){try{const[o]=await chrome.tabs.query({active:!0,currentWindow:!0});o?(await f(o.id),await g(e,r,o.id)):console.error("Активная вкладка не найдена.")}catch(o){console.error("Ошибка при поиске активной вкладки:",o)}}async function f(e){try{await chrome.scripting.executeScript({target:{tabId:e},func:()=>{console.log("Вкладка активирована.")},world:"MAIN"}),console.log("Вкладка успешно активирована.")}catch(r){console.error("Ошибка при активации вкладки:",r)}}async function g(e,r,o){try{await chrome.scripting.executeScript({target:{tabId:o},func:a,args:[e,r],world:"MAIN"}),console.log("Скрипт успешно внедрен на вкладку:",o)}catch(n){console.error("Ошибка при внедрении скрипта:",n)}}
