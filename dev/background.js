let a=[];function p(t){window.originalFetch||(window.originalFetch=window.fetch),window.fetch=async(n,r)=>{const i=typeof n=="string"?n:n instanceof URL?n.href:n.url,o=(r==null?void 0:r.method)||"GET";for(const e of t)if(e.isActive&&e.path&&i.includes(e.path)&&e.method===o){e.delay&&e.delay>0&&await new Promise(u=>setTimeout(u,e.delay));let c=200,s={},d=e.data||'{"title": "Пример JSON ответа"}';if(e.responseType==="error")c=400,d=e.errorResponse||JSON.stringify({error:"Bad Request",message:"Invalid data"}),s["Content-Type"]="application/json";else if(e.responseType==="redirect")c=301,s.Location=e.redirectUrl||"http://";else switch(e.successResponseType){case"json":s["Content-Type"]="application/json";break;case"text":s["Content-Type"]="text/plain";break;case"html":s["Content-Type"]="text/html";break;case"xml":s["Content-Type"]="application/xml";break;default:s["Content-Type"]="application/json"}return new Response(d,{status:c,headers:s})}return window.originalFetch(n,r)}}function h(){window.originalFetch&&(window.fetch=window.originalFetch)}async function l(t,n){try{await chrome.scripting.executeScript({target:{tabId:n},func:p,args:[t],world:"MAIN"})}catch(r){const i=r instanceof Error?r.message:"Неизвестная ошибка";chrome.runtime.sendMessage({action:"error",error:`Ошибка при внедрении скрипта: ${i}`})}}chrome.runtime.onMessage.addListener((t,n,r)=>{t.action==="updateRules"?(a=t.rules,chrome.storage.local.set({rules:a},()=>{chrome.runtime.lastError||chrome.storage.local.get(["isExtensionActive"],i=>{i.isExtensionActive&&chrome.tabs.query({active:!0,currentWindow:!0},o=>{var c;const e=(c=o[0])==null?void 0:c.id;e&&l(a,e)})})})):t.action==="activateExtension"?chrome.storage.local.set({isExtensionActive:!0},()=>{chrome.runtime.lastError||(chrome.action.setIcon({path:{16:"assets/icons/active/icon16.png",48:"assets/icons/active/icon48.png",128:"assets/icons/active/icon128.png"}}),chrome.tabs.query({active:!0,currentWindow:!0},i=>{var e;const o=(e=i[0])==null?void 0:e.id;o&&l(t.rules,o)}))}):t.action==="deactivateExtension"&&chrome.storage.local.set({isExtensionActive:!1},()=>{chrome.runtime.lastError||(chrome.action.setIcon({path:{16:"assets/icons/inactive/icon16.png",48:"assets/icons/inactive/icon48.png",128:"assets/icons/inactive/icon128.png"}}),chrome.tabs.query({active:!0,currentWindow:!0},i=>{var e;const o=(e=i[0])==null?void 0:e.id;o&&chrome.scripting.executeScript({target:{tabId:o},func:h,world:"MAIN"})}))})});chrome.tabs.onActivated.addListener(t=>{chrome.storage.local.set({isExtensionActive:!1},()=>{chrome.action.setIcon({path:{16:"assets/icons/inactive/icon16.png",48:"assets/icons/inactive/icon48.png",128:"assets/icons/inactive/icon128.png"}}),chrome.scripting.executeScript({target:{tabId:t.tabId},func:h,world:"MAIN"})})});chrome.tabs.onUpdated.addListener((t,n,r)=>{n.status==="complete"&&chrome.storage.local.get(["rules","isExtensionActive"],i=>{i.rules&&i.isExtensionActive&&l(i.rules,t)})});chrome.storage.local.get(["rules","isExtensionActive"],t=>{if(chrome.runtime.lastError)return;t.rules&&(a=t.rules),(t.isExtensionActive||!1)&&chrome.tabs.query({active:!0,currentWindow:!0},r=>{var o;const i=(o=r[0])==null?void 0:o.id;i&&l(a,i)})});
